<div id="page-content-wrapper">
    <div class="listing-dev">

        <nav class="navbar navbar-expand-lg navbar-light border-bottom" style="background-color: #FAFAFA;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="15.82125" viewBox="0 0 24 21.095">
                    <g transform="translate(0 -30.985)">
                        <g transform="translate(0 30.985)">
                            <g transform="translate(0 0)">
                                <path class="a"
                                    d="M16.688,35.345l-5.625-4.219a.705.705,0,0,0-1.125.563V33.8h-2.2a7.732,7.732,0,0,0-.759,15.427l-2.011-1.5a.7.7,0,0,1,0-1.125l2.137-1.6a3.516,3.516,0,0,1,.633-6.975h2.2v2.109a.705.705,0,0,0,1.125.562l5.625-4.219A.7.7,0,0,0,16.688,35.345Z"
                                    transform="translate(0 -30.985)" />
                            </g>
                        </g>
                        <g transform="translate(7.031 33.84)">
                            <g transform="translate(0 0)">
                                <path class="a"
                                    d="M159.987,91.884l2.011,1.5a.7.7,0,0,1,0,1.125l-2.137,1.6a3.516,3.516,0,0,1-.633,6.975h-2.109v-2.109a.705.705,0,0,0-1.125-.563l-5.719,4.219a.7.7,0,0,0,0,1.125l5.719,4.219a.7.7,0,0,0,1.125-.562v-2.109h2.109a7.732,7.732,0,0,0,.759-15.427Z"
                                    transform="translate(-149.992 -91.884)" />
                            </g>
                        </g>
                    </g>
                </svg>
                <label class="main-title" id="current_page_tag">Test Cycle</label>
            </button>

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ml-auto mt-2 mt-lg-0">
                    <li class="nav-item active" style="display: inline-block;">

                        <button class="aui-button aui-dropdown2-trigger aui-dropdown2-trigger-arrowless table-column-sort-icon tooltip_btn" title="Columns" aria-controls="testcycle-table-checkbox-items" id="button-spin-1">
                            <svg
                                xmlns="http://www.w3.org/2000/svg" width="19" height="14" viewBox="0 0 19 14">
                                <g transform="translate(0 -53.333)">
                                    <g transform="translate(0 53.333)">
                                        <path
                                            d="M4,53.333H1a1,1,0,0,0-1,1v12a1,1,0,0,0,1,1H4a1,1,0,0,0,1-1v-12A1,1,0,0,0,4,53.333Z"
                                            transform="translate(0 -53.333)"></path>
                                        <path
                                            d="M153.334,53.333h-3a1,1,0,0,0-1,1v12a1,1,0,0,0,1,1h3a1,1,0,0,0,1-1v-12A1,1,0,0,0,153.334,53.333Z"
                                            transform="translate(-142.334 -53.333)"></path>
                                        <path
                                            d="M302.667,53.333h-3a1,1,0,0,0-1,1v12a1,1,0,0,0,1,1h3a1,1,0,0,0,1-1v-12A1,1,0,0,0,302.667,53.333Z"
                                            transform="translate(-284.667 -53.333)"></path>
                                    </g>
                                </g>
                            </svg>
                        </button>

                        <span id="testcycleTableColumnCheckList"></span>



                        <button class="aui-button tooltip_btn table-column-sort-icon" id="filter-enable-disable-button" title="Filters" resolved="" onclick="showHideFilter('testcycle')">
                            <svg xmlns="http://www.w3.org/2000/svg" width="13.309" height="14" viewBox="0 0 13.309 14">
                                <g transform="translate(-10.118)">
                                    <g transform="translate(10.118)">
                                        <path
                                            d="M23.186,0H10.359a.239.239,0,0,0-.192.384l4.7,6.588A1.716,1.716,0,0,1,15.2,7.986v5.749c.017.192.175.315.332.245l2.674-1.014a.211.211,0,0,0,.14-.21V7.986a1.757,1.757,0,0,1,.332-1.014l4.7-6.588A.239.239,0,0,0,23.186,0Z"
                                            transform="translate(-10.118)"></path>
                                    </g>
                                </g>
                            </svg>
                        </button>


                        <input id="testcycleSearchKeyword" type="text" placeholder="Search..." class="search-bar" onchange="updateTestCycleListing()">
                        

                        {{!-- import button --}}
                        <button  id="dialog-show-button-import" class="aui-button">
                            <svg xmlns="http://www.w3.org/2000/svg" class="import-export" width="20.077" height="17" style="margin-right: 7.5px;"
                            viewBox="0 0 20.077 20">
                            <g transform="translate(0 -0.117)">
                                <path
                                d="M16.338,16.464H13v1.978h3.333c.992,0,1.761.506,1.761.942v8.771c0,.435-.769.942-1.761.942H3.738c-.991,0-1.76-.507-1.76-.942v-8.77c0-.436.769-.942,1.76-.942H7.071V16.465H3.738c-2.1,0-3.738,1.283-3.738,2.92v8.771c0,1.638,1.642,2.92,3.738,2.92h12.6c2.1,0,3.738-1.283,3.738-2.92V19.385C20.077,17.747,18.435,16.464,16.338,16.464Z"
                                transform="translate(0 -10.958)" fill="#344563" />
                                <path
                                d="M25.481,9.64a.986.986,0,0,0-.7.29l-1.238,1.238V1.106a.989.989,0,1,0-1.978,0V11.234L20.26,9.93a.989.989,0,0,0-1.4,1.4l2.953,2.953a.985.985,0,0,0,.7.289h.015a.984.984,0,0,0,.7-.289l2.953-2.953a.989.989,0,0,0-.7-1.688Z"
                                transform="translate(-12.45 0)" fill="#344563" />
                            </g>
                            </svg>Import
                        </button>


                        {{!-- export button --}}
                        <button class="aui-button aui-dropdown2-trigger btn_spinner export-report-icon" aria-controls="example-dropdown">
                            <svg xmlns="http://www.w3.org/2000/svg" class="import-export" width="20.077" height="18"
                                style="margin-right: 7.5px;margin-top: -4.5px;" viewBox="0 0 20.077 21">
                                <g transform="translate(0 0.883)">
                                    <path class="a"
                                        d="M16.338,16.464H13v1.978h3.333c.992,0,1.761.506,1.761.942v8.771c0,.435-.769.942-1.761.942H3.738c-.991,0-1.76-.507-1.76-.942v-8.77c0-.436.769-.942,1.76-.942H7.071V16.465H3.738c-2.1,0-3.738,1.283-3.738,2.92v8.771c0,1.638,1.642,2.92,3.738,2.92h12.6c2.1,0,3.738-1.283,3.738-2.92V19.385C20.077,17.747,18.435,16.464,16.338,16.464Z"
                                        transform="translate(0 -10.958)"></path>
                                    <path class="a"
                                        d="M25.48,5.047a.986.986,0,0,1-.7-.29L23.543,3.519V13.581a.989.989,0,1,1-1.978,0V3.452l-1.3,1.3a.989.989,0,0,1-1.4-1.4L21.814.406a.985.985,0,0,1,.7-.289h.015a.984.984,0,0,1,.7.289l2.952,2.953a.989.989,0,0,1-.7,1.688Z"
                                        transform="translate(-12.449 -1)"></path>
                                </g>
                            </svg>
                            Export
                        </button>
                        <aui-dropdown-menu id="example-dropdown">
                            <aui-section label="Export File as">
                                <aui-item-link href="javascript:void(0)" onclick="exportCsv('testcycle', 'csv')">.CSV Format</aui-item-link>
                                <aui-item-link href="javascript:void(0)" onclick="exportCsv('testcycle', 'xlsx')">.XLS Formate</aui-item-link>
                            </aui-section>
                        </aui-dropdown-menu>


                        <a href="javascript:void(0)" onclick="mainSidebarDirectRedirection('testcycle', 'add')" id="spinnerbutton" class="create-test-button create-testcycle-button aui-button aui-button-primary" resolved="">
                            + Create 
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
        <!---sub-sidebar-section--->
        <div id="sub-sidebar-div">
            <div class="aui-page-panel">
                <aside class="aui-page-panel-sidebar sub-sidebar"
                    style="width: 226.5px; background: background: #344563 ;">
                    <ul>
                        <li class="active">
                            <a id="addFolderButtonImg" href="javascript:void(0);" style="margin-right: 0 !important;" onclick="enabledAddFolderBox()">                                
                                <img src={{furl "/images/add_folder.svg"}} />
                            </a>
                            <a href="javascript:void(0);">
                                <img src={{furl "/images/expand_folder.svg"}} />                                
                            </a>
                            <a style="margin-left: 50.25px; margin-right: 6px;" href="javascript:void(0)" onclick="getFolderListByDataType('testcycle')">
                                <img src={{furl "/images/home.png"}} style="width: 21px;"/>
                            </a>
                        </li>

                        <div id="testcycle_folder_list" class="folder_list"></div>
                    
                        <button id="addFolderButton" onclick="enabledAddFolderBox()" class="create-button create_folder_button aui-button">+ Create New Folder</button>

                        <div id="addFolderInputBox" style="display: none;">
                            <form class="aui" action="javascript:void(0);" onsubmit="addNewFolderFormSubmit('testcycle')">                      
                                <input class="text medium-field" type="text" id="folderName" name="folderName" required="required"/>
                                <button style="border: none;">
                                    <img src={{furl "/images/folder-save.svg"}} />
                                </button>
                                <a href="javascript:void(0)" onclick="disabledAddFolderBoxPopup()" style="float: right;margin-right: 9px;">cancel</a>
                            </form>
                        </div>
                    </ul>
                </aside>
                <section class="aui-page-panel-content content-section">
                    <div id="testcycle-filter-section" class="filter-section hide">
                        <div>
                            <b>Filter: </b> 
                            <span id="testcycle-saved-filter"></span>
                            <span class="filter-save-edit-action">
                                <a id="f-save-a" class="f-action hide" href="javascript:void(0)" onclick="openFilter()">Save</a>
                                <a id="f-edit-a" class="f-action hide" href="javascript:void(0)" onclick="editCurrentFilter()">Edit</a>
                                <a id="f-delete-a" class="f-action hide" href="javascript:void(0)" onclick="deleteCurrentFilter()">Delete</a>
                                <a id="f-clear-all-a" class="f-action hide" href="javascript:void(0)" onclick="clearAllFilter()">Clear All</a>
                                <a id="f-reset-all-a" class="f-action hide" href="javascript:void(0)" onclick="resetFilter()">Reset All</a>
                            </span>
                        </div>
                        <div style="margin-top: 7.5px;">

                            <span class="filter-span" id="testcycle-Name-filter"></span>
                            <span class="filter-span" id="testcycle-Environment-filter"></span>
                            <span class="filter-span" id="testcycle-Owner-filter"></span>
                            <span class="filter-span" id="testcycle-Status-filter"></span>
                            <span class="filter-span" id="testcycle-Start-Date-filter"></span>
                            <span class="filter-span" id="testcycle-End-Date-filter"></span>
                            <span class="filter-span" id="testcycle-Last-Execution-filter"></span>
                            <span id="all-filter-span"></span>

                        </div>
                    </div>
                    <table class="aui">
                        <thead style="background: #dfe1e6;">
                            <tr>
                                <th id="basic-checkbox" style="width: 1px;">
                                    <input class="checkbox" type="checkbox" name="checkBoxOne" id="testcycle-header-checkbox">
                                </th>
                                <th id="basic-Key" style="width: 60px;"><b>Key</b></th>
                                <th id="basic-Name"><b>Name</b></th>
                                <th id="basic-Owner"><b>Owner</b></th>
                                <th id="basic-Environment"><b>Environment</b></th>
                                <th id="basic-Date"><b>Start / End Date</b></th>                               
                                <th id="basic-Progress"><b>Progress</b></th>
                                <th id="basic-Status"><b>Status</b></th>
                                <th id="basic-Last-Execution"><b>Last-Execution</b></th>
                                <th id="basic-actions test-action" style="text-align: right; padding-right: 18.75px;"><b>Actions</b></th>
                            </tr>
                        </thead>
                        <tbody id="testcycle_table_body" style="background-color: #F5F6F9;"></tbody>
                    </table>
                </section>
            </div>
        </div>
    </div>
</div>



{{!-- import csv modal popup --}}
<section
    id="demo-dialog-import"
    class="aui-dialog2 aui-dialog2-small aui-layer"
    role="dialog"
    tabindex="-1"
    aria-labelledby="dialog-show-button--heading"  style="width:382.5px"  
>
    <header class="aui-dialog2-header" style="background-color: white;">
        <h3 class="aui-dialog2-header-main" id="dialog-show-button--heading">
          <svg style="margin: 0 3px 4.5px 0; " xmlns="http://www.w3.org/2000/svg" width="20.077" height="20" viewBox="0 0 20.077 20"><g transform="translate(0 -0.117)"><path d="M16.338,16.464H13v1.978h3.333c.992,0,1.761.506,1.761.942v8.771c0,.435-.769.942-1.761.942H3.738c-.991,0-1.76-.507-1.76-.942v-8.77c0-.436.769-.942,1.76-.942H7.071V16.465H3.738c-2.1,0-3.738,1.283-3.738,2.92v8.771c0,1.638,1.642,2.92,3.738,2.92h12.6c2.1,0,3.738-1.283,3.738-2.92V19.385C20.077,17.747,18.435,16.464,16.338,16.464Z" transform="translate(0 -10.958)" fill="#000000"/><path d="M25.481,9.64a.986.986,0,0,0-.7.29l-1.238,1.238V1.106a.989.989,0,1,0-1.978,0V11.234L20.26,9.93a.989.989,0,0,0-1.4,1.4l2.953,2.953a.985.985,0,0,0,.7.289h.015a.984.984,0,0,0,.7-.289l2.953-2.953a.989.989,0,0,0-.7-1.688Z" transform="translate(-12.45 0)" fill="#000000"/></g></svg>
          Import from Files</h3>
        <button class="aui-close-button" type="button" aria-label="close"></button>
    </header>
    <div class="aui-dialog2-content" style="color: #B2BED4; overflow: hidden;" >
      <section class="image-upload"  ondrop="selectTestCaseCsv(event, true)"
        style="border:1px dashed #9c9a9a; position: relative; border-radius: 5px; padding: 15px;">
        <div style="display: flex; text-align: center;  justify-content: center; flex-direction: column;" id="dialog-import-csv-dropzone">
            <input type="file" accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" id="myfile" 
                onchange="selectTestCaseCsv(event)" name="myfile" style="width: 100%; opacity: 0; position: absolute; height: 100%; top: 0; left: 0;">

            <svg style="width: 100%; margin-bottom: 10.5px;" width="40px" height="40px" fill="#B2BED4" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                    viewBox="0 0 486.3 486.3" style="enable-background:new 0 0 486.3 486.3;" xml:space="preserve">
                <g>
                    <g>
                        <path d="M395.5,135.8c-5.2-30.9-20.5-59.1-43.9-80.5c-26-23.8-59.8-36.9-95-36.9c-27.2,0-53.7,7.8-76.4,22.5
                            c-18.9,12.2-34.6,28.7-45.7,48.1c-4.8-0.9-9.8-1.4-14.8-1.4c-42.5,0-77.1,34.6-77.1,77.1c0,5.5,0.6,10.8,1.6,16
                            C16.7,200.7,0,232.9,0,267.2c0,27.7,10.3,54.6,29.1,75.9c19.3,21.8,44.8,34.7,72,36.2c0.3,0,0.5,0,0.8,0h86
                            c7.5,0,13.5-6,13.5-13.5s-6-13.5-13.5-13.5h-85.6C61.4,349.8,27,310.9,27,267.1c0-28.3,15.2-54.7,39.7-69
                            c5.7-3.3,8.1-10.2,5.9-16.4c-2-5.4-3-11.1-3-17.2c0-27.6,22.5-50.1,50.1-50.1c5.9,0,11.7,1,17.1,3c6.6,2.4,13.9-0.6,16.9-6.9
                            c18.7-39.7,59.1-65.3,103-65.3c59,0,107.7,44.2,113.3,102.8c0.6,6.1,5.2,11,11.2,12c44.5,7.6,78.1,48.7,78.1,95.6
                            c0,49.7-39.1,92.9-87.3,96.6h-73.7c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5h74.2c0.3,0,0.6,0,1,0c30.5-2.2,59-16.2,80.2-39.6
                            c21.1-23.2,32.6-53,32.6-84C486.2,199.5,447.9,149.6,395.5,135.8z"/>
                        <path d="M324.2,280c5.3-5.3,5.3-13.8,0-19.1l-71.5-71.5c-2.5-2.5-6-4-9.5-4s-7,1.4-9.5,4l-71.5,71.5c-5.3,5.3-5.3,13.8,0,19.1
                            c2.6,2.6,6.1,4,9.5,4s6.9-1.3,9.5-4l48.5-48.5v222.9c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5V231.5l48.5,48.5
                            C310.4,285.3,318.9,285.3,324.2,280z"/>
                    </g>
                </g>
            </svg>

            <h5 class="drop-files" style="color: #B2BED4; text-align: center;" >Click to browse <br>
            OR<br>
            Drop your file here</h5>
            <h6></h6>
        </div>
        <div style="padding: 45px 0; display: block; display: none;" id="dialog-import-csv-progress-div">
            <aui-progressbar id="dialog-import-csv-progress" value="0" max="100"></aui-progressbar>
        </div>
      </section>
        <ul style="list-style-type:disc; padding-left: 15px; margin: 10.5px 0 0 0;">
          <li>Only .csv and .xls files are allowed.</li>
          <li>Max. file size 2MB.</li>
        </ul>
    </div>
    <footer class="aui-dialog2-footer">
        <div class="aui-dialog2-footer-actions">
            <button class="aui-button aui-button-link" resolved="" onclick="downloadTestcaseSampleFile()">Download Sample File</button>
            <a style="opacity:0;" id="testCasesampleFileLink" href={{furl "/file/testcycle-sample-file.csv"}} download="test-cycle-sample.csv"></a>
            <button id="dialog-submit-button-import" class="aui-button aui-button-primary" onclick="uploadCsv('testcycle')">Start Import</button>
        </div>
    </footer>
</section>



{{!-- filter add edit Dialog --}}
<section
    id="filter-add-edit-dialog"
    class="aui-dialog2 aui-dialog2-small aui-layer"
    role="dialog"
    tabindex="-1"
    aria-labelledby="filter-add-edit-dialog-heading"
    hidden
>
    <header class="aui-dialog2-header">
        <h3 class="aui-dialog2-header-main" id="filter-add-edit-dialog-heading">Save Filter</h3>
        <button class="aui-close-button" type="button" aria-label="close" onclick="closeFilter()"></button>
    </header>
    <form class="aui" name="myform" action="javascript:void(0);" style="margin: 0;">
        <input id="filter_id" type="hidden" name="filter_id">
        <div class="aui-dialog2-content">
            <div class="form-group">
                <label class="label required-field">Name</label>
                <input id="filter_name" type="text" class="form-control text medium-field" name="filter_name" placeholder="Enter name" required="required">
            </div>
            <div class="form-group select-field-type">
                <label class="label required-field">Visibility</label>
                <select id="filter_visibility" class="form-control select customFieldTypeSelect" name="filter_visibility" required="required" style="max-width: 100%;">
                    <option value="Public">Public</option>
                    <option value="Private">Private</option>
                </select>
            </div>
        </div>
        <footer class="aui-dialog2-footer">
            <div class="aui-dialog2-footer-actions">
                <button type="submit" class="aui-button aui-button-primary" onclick="addUpdateFilter('testcycle')">Save</button>
                <button type="button" class="aui-button" onclick="closeFilter()">Cancel</button>
            </div>
        </footer>
    </form>
</section>





























<script>

    loadList("{{selectedFolderId}}");

    function loadList(folder_id="")
    {
        if(folder_id === "" || folder_id === "null" || folder_id === null)
        {
            getFolderListByDataType('testcycle');
        }
        else
        {
            getFolderListByDataType('testcycle', false, folder_id);
        }
    }    

    /*
     ===============================
     Import functionality
     ==============================
    */
    //click link button to download sample csv file
    function downloadTestcaseSampleFile(){         
        document.getElementById('testCasesampleFileLink').click();
    }


    //import button popup
    AJS.$("#dialog-show-button-import").on('click', function(e) {        
        e.preventDefault();
        AJS.dialog2("#demo-dialog-import").show();
    });


    /*
     Show/hide columns
    */
    const uniqueArrayFilter = (value, index, self) => {
        return self.indexOf(value) === index
    }
 

    const uniqueArrayFilterObject = (v, index, self) => {
        return self.findIndex(v.filter) === index
    }


    function updateTableColumnFilterValue() 
    {
        let all_column = ["Key", "Name", "Owner", "Environment", "Date", "Progress", "Status", "Last-Execution"];

        let tableColumnSortHtml = '<aui-dropdown-menu id="testcycle-table-checkbox-items"><aui-section label="Select Columns">';
        for (let j = 0; j < all_column.length; j++) 
        {
            let temp_index = testcycleTableColumn.indexOf(all_column[j]);

            if(temp_index !== -1) {
                tableColumnSortHtml += '<aui-item-checkbox interactive checked>'+all_column[j]+'</aui-item-checkbox>';
            } else {
                tableColumnSortHtml += '<aui-item-checkbox interactive>'+all_column[j]+'</aui-item-checkbox>';
            }                
        }
        tableColumnSortHtml += '</aui-section></aui-dropdown-menu>';
        
        $('#testcycleTableColumnCheckList').html(tableColumnSortHtml);



        var dropdown = document.getElementById('testcycle-table-checkbox-items');
        dropdown.addEventListener('change', function (e) {        
            var isChecked = e.target.hasAttribute('checked');
            if (isChecked) {
                testcycleTableColumn.push(e.target.textContent);
            } else {            
                let index = testcycleTableColumn.indexOf(e.target.textContent)
                testcycleTableColumn.splice(index, 1);
            }

            testcycleTableColumn = testcycleTableColumn.filter(uniqueArrayFilter);
            AP.cookie.save('testcycleTableColumn', JSON.stringify(testcycleTableColumn));
            updateTestTableColumBestOnSelection()
        });
    }  


    function updateTestTableColumBestOnSelection()
    {        
        let all_column = ["Key", "Name", "Owner", "Environment", "Date", "Progress", "Status", "Last-Execution"];
            
        for (let j = 0; j < all_column.length; j++) 
        {
            let temp_index = testcycleTableColumn.indexOf(all_column[j]);

            if(temp_index !== -1) {
                $('#basic-'+all_column[j]).css('display', '');
                $('.basic-'+all_column[j]).css('display', '');
            } else {
                $('#basic-'+all_column[j]).css('display', 'none');
                $('.basic-'+all_column[j]).css('display', 'none');
            }
        }
    }  



































    var savedFilterList = [];
    var selectedSavedFilter = null;
    var selectedFilterCriteria = [];


    getAllFilter();
    updateAllFilters();



    function updateAllFilters() 
    {       
        $('#all-filter-span').html("");

        let all_filter = ["Name", "Environment", "Owner", "Status", "Start-Date", "End-Date", "Last-Execution"];

        let filterHtml = `<button class="aui-button aui-dropdown2-trigger filter-button" aria-controls="filter-criteria">Add criteria</button>
                        <aui-dropdown-menu id="filter-criteria"><aui-section label="Select Columns">`;

        for (let j = 0; j < all_filter.length; j++) 
        {
            let temp_index = selectedFilterCriteria.findIndex(x => x.filter == all_filter[j]);
            if(temp_index !== -1) {
                filterHtml += '<aui-item-checkbox checked>'+all_filter[j]+'</aui-item-checkbox>';
            } else {
                filterHtml += '<aui-item-checkbox>'+all_filter[j]+'</aui-item-checkbox>';
            }                
        }
        filterHtml += '</aui-section></aui-dropdown-menu>';        
        $('#all-filter-span').html(filterHtml);

        var dropdown = document.getElementById('filter-criteria');
        dropdown.addEventListener('change', function (e) {        
            var isChecked = e.target.hasAttribute('checked');
            if (isChecked) {
                if(e.target.textContent == 'Name' || e.target.textContent == 'Start-Date' || e.target.textContent == 'End-Date' || e.target.textContent == 'Last-Execution') {
                    selectedFilterCriteria.push({
                        'filter': e.target.textContent,
                        'value': 'All'
                    });
                } else {
                    selectedFilterCriteria.push({
                        'filter': e.target.textContent,
                        'value': []
                    });
                }
            } else {            
                let index = selectedFilterCriteria.findIndex(x => x.filter == e.target.textContent);
                selectedFilterCriteria.splice(index, 1);
            }

            const result = [];
            const map = new Map();
            for (const item of selectedFilterCriteria) {
                if(!map.has(item.filter)){
                    map.set(item.filter, true);
                    result.push({
                        filter: item.filter,
                        value: item.value
                    });
                }
            }            
            selectedFilterCriteria = result;
            updateTestCycleListingWithFilter(selectedFilterCriteria);
            addFilter()
        });
    } 



    function addFilter (type='testcycle') 
    {
        let all_filter = ["Name", "Environment", "Owner", "Status", "Start-Date", "End-Date", "Last-Execution"];
             
        $('.filter-span').html('');
        
        $('.f-action').addClass('hide');
        $('.f-action').removeClass('show');

        if(selectedFilterCriteria.length > 0) {
            if(selectedSavedFilter !== null)
            {
                if(selectedSavedFilter.acct_id == "{{userAccountId}}")
                {
                    $('#f-save-a').removeClass('hide');
                    $('#f-save-a').addClass('show');

                    $('#f-edit-a').removeClass('hide');
                    $('#f-edit-a').addClass('show');

                    $('#f-delete-a').removeClass('hide');
                    $('#f-delete-a').addClass('show');
                } 

                $('#f-clear-all-a').removeClass('show');
                $('#f-clear-all-a').addClass('hide');

                $('#f-reset-all-a').removeClass('hide');
                $('#f-reset-all-a').addClass('show');
            } 
            else 
            {
                $('#f-save-a').removeClass('hide');
                $('#f-save-a').addClass('show');

                $('#f-reset-all-a').addClass('hide');
                $('#f-reset-all-a').removeClass('show');

                $('#f-clear-all-a').removeClass('hide');
                $('#f-clear-all-a').addClass('show');
            }
        }

        for (let j = 0; j < all_filter.length; j++) 
        {
            let filter = '';

            let temp_index = selectedFilterCriteria.findIndex(x => x.filter == all_filter[j]);

            if(temp_index !== -1) 
            {
                if(all_filter[j] == "Name")
                {
                    filter = `<button class="aui-button aui-dropdown2-trigger filter-button" aria-controls="save-filter-`+all_filter[j]+`-select">`+all_filter[j]+`: <span id='filter-value-`+all_filter[j]+`'>`+selectedFilterCriteria[temp_index].value+`</span></button>
                                <span onclick="removeFilter('`+all_filter[j]+`')" class="filter-remove-icon aui-icon aui-icon-small aui-iconfont-add-circle">Remove</span>
                                <aui-dropdown-menu id="save-filter-`+all_filter[j]+`-select">
                                    <form action="javascript:void(0)" onsubmit="submitFromInputSearch('`+all_filter[j]+`')" class="aui filter-form">
                                        <div class="form-group">
                                            <input id="filter`+all_filter[j]+`Input" class="form-control text medium-field" placeholder="Contains text">
                                        </div>
                                        <div class="filter-form-action">                                                      
                                            <button type="submit" class="aui-button aui-button-primary">Update</button>
                                            <button type="button" class="aui-button aui-button-primary" onclick="clearFromInputSearch('`+all_filter[j]+`')">Cancel</button>
                                        </div>
                                    </form>
                                </aui-dropdown-menu>`;
    
                    $('#testcycle-'+all_filter[j]+'-filter').html(filter);
                    clearFromInputSearch(all_filter[j]);
                }
                else if(all_filter[j] == "Start-Date" || all_filter[j] == "End-Date" || all_filter[j] == "Last-Execution")
                {
                    filter = `<button class="aui-button aui-dropdown2-trigger filter-button" aria-controls="save-filter-`+all_filter[j]+`-select">`+all_filter[j]+`: <span id='filter-value-`+all_filter[j]+`'>`+selectedFilterCriteria[temp_index].value+`</span></button>
                                <span onclick="removeFilter('`+all_filter[j]+`')" class="filter-remove-icon aui-icon aui-icon-small aui-iconfont-add-circle">Remove</span>
                                <aui-dropdown-menu id="save-filter-`+all_filter[j]+`-select">
                                    <form action="javascript:void(0)" onsubmit="submitDateFromInputSearch('`+all_filter[j]+`')" class="aui filter-form" style="width: 161.25px;">
                                        <div class="form-group">
                                            <label class="label">Min</label>
                                            <input type="date" id="filterMin`+all_filter[j]+`Input" onchange="onchangeFilterDate('`+all_filter[j]+`')" class="form-control text medium-field" placeholder="Min date">
                                        </div>
                                        <div class="form-group">
                                            <label class="label">Max</label>
                                            <input type="date" id="filterMax`+all_filter[j]+`Input" onchange="onchangeFilterDate('`+all_filter[j]+`')" class="form-control text medium-field" placeholder="Max date">
                                        </div>
                                        <div id="date`+all_filter[j]+`warning" style="display: none;color: red;margin-bottom: 7.5px;">Note: Min date should be less than or equal to max date</div>
                                        <div class="filter-form-action">                                                      
                                            <button id="date`+all_filter[j]+`FormSubmitButton" type="submit" class="aui-button aui-button-primary" disabled >Update</button>
                                            <button type="button" class="aui-button aui-button-primary" onclick="clearDateFromInputSearch('`+all_filter[j]+`')">Cancel</button>
                                            <button type="button" class="aui-button aui-button-primary" onclick="clearAllDateFromInputSearch('`+all_filter[j]+`')">Clear</a>
                                        </div>
                                    </form>
                                </aui-dropdown-menu>`;
                                
                    $('#testcycle-'+all_filter[j]+'-filter').html(filter);
                    clearDateFromInputSearch(all_filter[j])
                }
                else
                {                            
                    if(all_filter[j] == "Environment") 
                    {
                        if(testcycle_environment_list.length == 0)
                        {
                            $('#action-loader-wrapper').css('display', 'flex');
                            $.ajax({
                                "type": "GET",
                                "url": "/environment/allList?project_id={{projectId}}&user={{userAccountId}}&domain_id=" + domain_id,
                                "headers": {
                                    'Authorization': "JWT "+user_token,
                                },
                                "dataType": "json",
                                "error": function (xhr, textStatus, errorThrown) {
                                    toaster('Error while fetching project details', 'error');
                                    $('#action-loader-wrapper').css('display', 'none');
                                },
                                "success": function (data) {
                                    if (data.res.status === 200) 
                                    {
                                        testcycle_environment_list = data.res.data.environment;
                                        dropdownValueUpdateFunction(all_filter[j], selectedFilterCriteria[temp_index].value, testcycle_environment_list, 'ec_name');
                                    }
                                }
                            });
                        }
                        else
                        {
                            dropdownValueUpdateFunction(all_filter[j], selectedFilterCriteria[temp_index].value, testcycle_environment_list, 'ec_name');
                        }
                    }
                    else if(all_filter[j] == "Owner") 
                    {
                        let temp_jiraUserListArray = jiraUserListArray;
                        dropdownValueUpdateFunction(all_filter[j], selectedFilterCriteria[temp_index].value, temp_jiraUserListArray, 'id');
                    }
                    else if(all_filter[j] == "Status") 
                    {
                        if(testcycle_status_list == 0)
                        {
                            $('#action-loader-wrapper').css('display', 'flex');
                            $.ajax({
                                "type": "GET",
                                "url": "/configuration/statusList?project_id={{projectId}}&user={{userAccountId}}&sc_type="+type+"&domain_id=" + domain_id,
                                "headers": {
                                    'Authorization': "JWT "+user_token,
                                },
                                "dataType": "json",
                                "error": function (xhr, textStatus, errorThrown) {
                                    toaster('Error while fetching project details', 'error');
                                    $('#loader-wrapper').css('display', 'none');
                                    $('#action-loader-wrapper').css('display', 'none');
                                },
                                "success": function (data) {
                                    if (data.res.status === 200) 
                                    {
                                        testcycle_status_list = data.res.data;
                                        dropdownValueUpdateFunction(all_filter[j], selectedFilterCriteria[temp_index].value, testcycle_status_list, 'sc_name');
                                    }
                                }
                            });
                        }
                        else
                        {
                            dropdownValueUpdateFunction(all_filter[j], selectedFilterCriteria[temp_index].value, testcycle_status_list, 'sc_name');
                        }

                    }
                    else
                    {
                        filter = `<button class="aui-button aui-dropdown2-trigger filter-button" aria-controls="save-filter-`+all_filter[j]+`-select">`+all_filter[j]+`: `+selectedFilterCriteria[temp_index].value+`</button>
                        <span onclick="removeFilter('`+all_filter[j]+`')" class="filter-remove-icon aui-icon aui-icon-small aui-iconfont-add-circle">Remove</span>
                        <aui-dropdown-menu id="save-filter-`+all_filter[j]+`-select">
                        <aui-section><aui-item-radio>dfgdfgdgdg</aui-item-radio>
                        </aui-section></aui-dropdown-menu>`;

                        $('#testcycle-'+all_filter[j]+'-filter').html(filter);
                    }           
                }
            }            
        }
    }



    function removeFilter(filter)
    {
        let index = selectedFilterCriteria.findIndex(x => x.filter == filter);
        selectedFilterCriteria.splice(index, 1);
        updateAllFilters();
        addFilter();
    }



    function clearAllFilter()
    {
        selectedFilterCriteria = [];
        updateAllFilters();
        addFilter();
    }



    function openFilter()
    {
        if(selectedSavedFilter && selectedSavedFilter.id && selectedSavedFilter.id != '') {
            $('#filter_id').val(selectedSavedFilter.id);
            $('#filter_name').val(selectedSavedFilter.filter_name);
            addUpdateFilter('testcycle');

        } else {
            $('#filter_id').val('');
            $('#filter_name').val('');
            $('#filter-add-edit-dialog-heading').html('Save Filter');
            AJS.dialog2("#filter-add-edit-dialog").show();
        }
    }



    function editCurrentFilter()
    {
        $('#filter_id').val(selectedSavedFilter.id);
        $('#filter_name').val(selectedSavedFilter.filter_name);
        $('#filter-add-edit-dialog-heading').html('Update Filter');
        AJS.dialog2("#filter-add-edit-dialog").show();
    }



    function closeFilter()
    {
        $('#filter_id').val('');
        $('#filter_name').val('');
        AJS.dialog2("#filter-add-edit-dialog").hide();
    }



    function getValueHtmlFromArr(val_arr)
    {
        let value_html = '';

        val_arr = val_arr.filter(uniqueArrayFilter);

        if(val_arr.length > 0) 
        {
            for (let l = 0; l < val_arr.length; l++) 
            {                
                if(l+1 == val_arr.length) {
                    value_html += val_arr[l];
                } else {
                    value_html += val_arr[l]+', ';
                }
            } 
        }
        else
        {
            value_html = 'All'
        }

        return value_html;
    }



    function dropdownValueUpdateFunction(filter, value, list, key)
    {   
        let value_html = getValueHtmlFromArr(value);

        let html = `<button class="aui-button aui-dropdown2-trigger filter-button" aria-controls="save-filter-`+filter+`-select">`+filter+`: <span id='filter-value-`+filter+`'>`+value_html+`</span></button>
        <span onclick="removeFilter('`+filter+`')" class="filter-remove-icon aui-icon aui-icon-small aui-iconfont-add-circle">Remove</span>
        <aui-dropdown-menu id="save-filter-`+filter+`-select">
        <aui-section>`;

        for (let k = 0; k < list.length; k++) 
        {
            let check = value.indexOf(list[k][key]) != -1 ? 'checked' : '';
            html += `<aui-item-checkbox `+check+`>`+list[k][key]+`</aui-item-checkbox>`;
        }
        html += `</aui-section></aui-dropdown-menu>`;

        $('#testcycle-'+filter+'-filter').html(html);


        var dropdown = document.getElementById(`save-filter-`+filter+`-select`);
        dropdown.addEventListener('change', function (e) {   

            let index = selectedFilterCriteria.findIndex(x => x.filter == filter);     
            selectedFilterCriteria[index].value = selectedFilterCriteria[index].value.filter(uniqueArrayFilter);

            var isChecked = e.target.hasAttribute('checked');

            if (isChecked) {
                selectedFilterCriteria[index].value.push(e.target.textContent);                
            } else {            
                let remove_index = selectedFilterCriteria[index].value.indexOf(e.target.textContent);
                selectedFilterCriteria[index].value.splice(remove_index, 1);
            }
            let value_html = getValueHtmlFromArr(selectedFilterCriteria[index].value);
            $('#filter-value-'+filter).html(value_html);
            updateTestCycleListingWithFilter(selectedFilterCriteria);
        });

        
        $('#action-loader-wrapper').css('display', 'none');
    }



    function clearFromInputSearch(filter)
    {
        let index = selectedFilterCriteria.findIndex(x => x.filter == filter);
        $('#filter'+filter+'Input').val(selectedFilterCriteria[index].value);
    }



    function resetFilter(filter)
    {
        selectedFilterCriteria = JSON.parse(selectedSavedFilter.filter_key);
        updateTestCycleListingWithFilter(selectedFilterCriteria);
        addFilter();
    }



    function submitFromInputSearch(filter)
    {
        let new_val =  $('#filter'+filter+'Input').val();
        let index = selectedFilterCriteria.findIndex(x => x.filter == filter);
        selectedFilterCriteria[index].value = new_val;
        $('#filter-value-'+filter).html(new_val == '' ? 'All' : new_val);
        updateTestCycleListingWithFilter(selectedFilterCriteria);
    }



    function submitDateFromInputSearch(filter)
    {
        let max_date =  $('#filterMax'+filter+'Input').val();
        let min_date =  $('#filterMin'+filter+'Input').val();
        
        let value_html = max_date+' to '+min_date;
        let index = selectedFilterCriteria.findIndex(x => x.filter == filter);
        selectedFilterCriteria[index].value = value_html;
        $('#filter-value-'+filter).html(value_html);
        updateTestCycleListingWithFilter(selectedFilterCriteria);
    }



    function clearDateFromInputSearch(filter)
    {
        let index = selectedFilterCriteria.findIndex(x => x.filter == filter);
        let date_arr = selectedFilterCriteria[index].value.split(" to "); 
        $('#filterMax'+filter+'Input').val(date_arr[0]);
        $('#filterMin'+filter+'Input').val(date_arr[1]);
    }



    function clearAllDateFromInputSearch(filter)
    {
        let index = selectedFilterCriteria.findIndex(x => x.filter == filter);
        selectedFilterCriteria[index].value = 'All';
        $('#filter-value-'+filter).html('All');
        $('#filterMax'+filter+'Input').val('');
        $('#filterMin'+filter+'Input').val('');
        updateTestCycleListingWithFilter(selectedFilterCriteria);
    }



    function onchangeFilterDate(filter)
    {
        let min_date =  $('#filterMin'+filter+'Input').val();
        let max_date =  $('#filterMax'+filter+'Input').val();

        console.log(min_date)

        if(max_date !== "" && min_date !== "") {
            if(Date.parse(min_date) <= Date.parse(max_date)) {
                $('#date'+filter+'FormSubmitButton').attr("disabled", false);
                $('#date'+filter+'warning').css('display', 'none');
            } else {
                $('#date'+filter+'FormSubmitButton').attr("disabled", true);
                $('#date'+filter+'warning').css('display', 'block');
            }
        } else {
            $('#date'+filter+'FormSubmitButton').attr("disabled", true);
        }
    }



    function addUpdateFilter(type) 
    {
        let filter_id = $('#filter_id').val();
        let filter_name = $('#filter_name').val();
        let filter_type = $('#filter_visibility').val();

        if(filter_name !== "")
        {
            let url = filter_id ? "/customFilter/update?user={{userAccountId}}" : "/customFilter/create?user={{userAccountId}}";

            let data = {
                'acct_id': "{{userAccountId}}",
                'project_id': "{{projectId}}",
                'domain_id': domain_id,
                'filter_name': filter_name,
                'test_type': type,
                'filter_key': JSON.stringify(selectedFilterCriteria),
                'filter_type': filter_type
            }

            if(filter_id !== '') {
                data.custom_filter_id = filter_id;
            }

            $('#action-loader-wrapper').css('display', 'flex');
            $.ajax({
                "type": filter_id ? "PUT" : "POST",
                "url": url,
                "headers": {
                    'Authorization': "JWT "+user_token,
                },
                "data": data,
                "dataType": "json",
                "error": function (xhr, textStatus, errorThrown) {
                    toaster('Error while fetching project details', 'error');
                    $('#action-loader-wrapper').css('display', 'none');
                },
                "success": function (data) {
                    if (data.res.status === 200) {
                        closeFilter();
                        if(filter_id == '') {
                            selectedSavedFilter = data.res.data;
                        } else {
                            selectedSavedFilter.filter_name = filter_name
                            selectedSavedFilter.filter_type = filter_type
                        }
                        if(filter_id !== '') {
                            toaster('Filter added successfully');
                        } else {
                            toaster('Filter updated successfully');
                        }
                        updateTestCycleListingWithFilter(selectedFilterCriteria);
                        getAllFilter();
                    }
                }
            });
        }
        else
        {
            toaster('Please enter required details', 'warning');
        }
    }



    function deleteCurrentFilter() 
    {
        $('#action-loader-wrapper').css('display', 'flex');
        $.ajax({
            "type": "PUT",
            "url": "/customFilter/delete?user={{userAccountId}}",
            "headers": {
                'Authorization': "JWT "+user_token,
            },
            "data": {
                'acct_id': "{{userAccountId}}",
                'project_id': "{{projectId}}",
                'domain_id': domain_id,
                'custom_filter_id': selectedSavedFilter.id
            },
            "dataType": "json",
            "error": function (xhr, textStatus, errorThrown) {
                toaster('Error while fetching project details', 'error');
                $('#action-loader-wrapper').css('display', 'none');
            },
            "success": function (data) {
                if (data.res.status === 200) {
                    selectedSavedFilter = null;
                    updateTestCycleListingWithFilter(selectedFilterCriteria);
                    getAllFilter();
                }
            }
        });
    }



    function getAllFilter(type='testcycle')
    {
        $('#action-loader-wrapper').css('display', 'flex');
        $.ajax({
            "type": "GET",
            "url": "/customFilter/list?project_id={{projectId}}&acct_id={{userAccountId}}&test_type=" + type + "&domain_id=" + domain_id,
            "headers": {
                'Authorization': "JWT "+user_token,
            },
            "dataType": "json",
            "error": function (xhr, textStatus, errorThrown) {
                toaster('Error while fetching project details', 'error');
                $('#action-loader-wrapper').css('display', 'none');
            },
            "success": function (data) {
                if (data.res.status === 200) {

                    savedFilterList = [{filter_key: '[]', filter_name: 'none' }, ...data.res.data];

                    let html = `<button class="aui-button aui-dropdown2-trigger filter-button" aria-controls="saved-filter-select"><span id='saved-filter-value'>Choose saved filter</span></button>
                    <aui-dropdown-menu id="saved-filter-select">
                    <aui-section>`;

                    for (let k = 0; k < savedFilterList.length; k++) 
                    {
                        let check = selectedSavedFilter ? selectedSavedFilter.filter_name == savedFilterList[k].filter_name ? 'checked' : '' : '';

                        if(selectedSavedFilter == null && savedFilterList[k].filter_name == 'none') {
                            check = 'checked';
                        }

                        html += `<aui-item-radio `+check+`>`+savedFilterList[k].filter_name+`</aui-item-radio>`;
                    }
                    html += `</aui-section></aui-dropdown-menu><span class="filter-type hide" id="testcycle-selected-saved-filter-type"></span>`;

                    $('#testcycle-saved-filter').html(html);

                    var dropdown = document.getElementById(`saved-filter-select`);
                    dropdown.addEventListener('change', function (e) {   

                        let index = savedFilterList.findIndex(x => x.filter_name == e.target.textContent);
                        var isChecked = e.target.hasAttribute('checked');
                        if (isChecked) {
                            if(e.target.textContent == 'none') {
                                selectedSavedFilter = null;
                                $('#testcycle-selected-saved-filter-type').removeClass('show2');
                                $('#testcycle-selected-saved-filter-type').addClass('hide');     
                                $('#saved-filter-value').html('Choose saved filter');                            
                            } else {
                                selectedSavedFilter = savedFilterList[index];  
                                $('#testcycle-selected-saved-filter-type').removeClass('hide'); 
                                $('#testcycle-selected-saved-filter-type').addClass('show2');   
                                $('#testcycle-selected-saved-filter-type').html(savedFilterList[index].filter_type); 
                                $('#saved-filter-value').html(e.target.textContent);
                            }   
                            selectedFilterCriteria = JSON.parse(savedFilterList[index].filter_key);    
                            updateAllFilters();
                            addFilter();   
                        }

                    });        
                }
                $('#action-loader-wrapper').css('display', 'none');
            }
        });
    }




    
</script>